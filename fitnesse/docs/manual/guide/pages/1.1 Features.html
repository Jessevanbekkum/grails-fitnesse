<html>
    <head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
        <title>1.1 Features</title>
        <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" title="Ref" charset="utf-8"/>
    </head>
    <body class="body">
    The Fitnesse plugin supports some additional features besides the standard Fitnesse functionality.<p class="paragraph"/><h3>Templates (since 0.4)</h3><p class="paragraph"/>You can now easily create Fixtures by typing:<p class="paragraph"/><div class="code"><pre>grails create&#45;fitnesse&#45;query&#45;fixture &#60;name of fixture&#62;</pre></div><p class="paragraph"/>Or<p class="paragraph"/><div class="code"><pre>grails create&#45;fitnesse&#45;fixture &#60;name of fixture&#62;</pre></div><p class="paragraph"/>This will create a fixture in the grails-app&#102;itnesse directory, which should give you a head start on how to create a Fixture.<p class="paragraph"/><h3>Complex objects (since 0.4)</h3><p class="paragraph"/>You can now create complex objects from within Fitnesse. This uses the JSON format, since it's easy to read and write, and is becoming quite a standard.<p class="paragraph"/>An example can be seen below:<p class="paragraph"/><strong class="bold">Wiki</strong>
<div class="code"><pre>|create book inventory                     |
|book                               |amount|
|&#123;author: Stephen King, title: IT&#125;  |     3|
|&#123;author: Dean Koontz, title: Chase&#125;|     5|</pre></div><p class="paragraph"/>This JSON code in the test is mapped to the following Fixture and Domain class:<p class="paragraph"/><strong class="bold">Fixture</strong>
<div class="code"><pre>class CreateBookInventoryFixture &#123;
    Book book<p class="paragraph"/>    <span class="java&#45;object">int</span> amount<p class="paragraph"/>    def bookService<p class="paragraph"/>    CreateBookInventoryFixture() &#123;
        Book.list()&#42;.delete()
    &#125;<p class="paragraph"/>    void execute() &#123;
        amount.times &#123;
            book.id = <span class="java&#45;keyword">null</span>
            bookService.addBook(book)
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/>And the very simple Domain class:<p class="paragraph"/><div class="code"><pre>class Book &#123;
    <span class="java&#45;object">String</span> author
    <span class="java&#45;object">String</span> title
&#125;</pre></div><p class="paragraph"/><h3>Query Fixture DSL (since 0.4)</h3><p class="paragraph"/>To make writing Query fixtures much easier, we've introduced the concept of a simple mapping DSL. This means that mapping values from, let's say a services, becomes almost trivial.<p class="paragraph"/>Consider the following Service method:<p class="paragraph"/><div class="code"><pre>def checkInventory() &#123;
    Book.executeQuery(<span class="java&#45;quote">"select b.title, b.author, count(&#42;) from Book b group by title, author"</span>)
&#125;</pre></div><p class="paragraph"/>If you want to use this method in a Fixture, you can do by using the mapping DSL. An example can be shown below. Note that this only works for Query fixtures!<p class="paragraph"/><div class="code"><pre>class CheckBookInventoryFixture &#123;
    def queryFixture = <span class="java&#45;keyword">true</span>                              // indication that <span class="java&#45;keyword">this</span> is a query fixture
    <span class="java&#45;keyword">static</span> mapping   = &#91;title: 0, author: 1, amount: 2&#93;  // the mapping<p class="paragraph"/>    def bookService        // injected service<p class="paragraph"/>    def queryResults() &#123;  // queryResults() method, which must be named like <span class="java&#45;keyword">this</span>!
        bookService.checkInventory()
    &#125;
&#125;</pre></div><p class="paragraph"/><h3>Strings as methods</h3>
Groovy supports methods like <code>"this is a method"</code>. The Fitnesse plugin also supports this, making some Fixtures more readable.<p class="paragraph"/><strong class="bold">Example</strong>
<div class="code"><pre>class MyFixture &#123;
  <span class="java&#45;object">boolean</span> <span class="java&#45;quote">"check <span class="java&#45;keyword">if</span> customers exists"</span>(<span class="java&#45;object">int</span> customerNumber) &#123;
     // &#8230;
  &#125;
&#125;</pre></div><p class="paragraph"/><h4>Default arguments</h4>
Groovy supports default arguments. The Grails Fitnesse plugin also supports this:<p class="paragraph"/><div class="code"><pre>class MyFixture &#123;
  MyFixture(<span class="java&#45;object">boolean</span> clearDatabase = <span class="java&#45;keyword">false</span>) &#123;
    // &#8230;
  &#125;
&#125;</pre></div><p class="paragraph"/><strong class="bold">Wiki:</strong>
<div class="code"><pre>|my fixture|<span class="java&#45;keyword">true</span>|</pre></div><p class="paragraph"/><h3>Untyped arguments</h3>
Groovy supports default arguments. Fitnesse also supports this:<p class="paragraph"/><div class="code"><pre>class MyFixture &#123;
  <span class="java&#45;object">boolean</span> checkCustomer(customerNumber) &#123;
    // &#8230;
  &#125;
&#125;</pre></div><p class="paragraph"/><blockquote class="note">
Note that the Fitnesse SLIM protocol only supports Strings and Lists. A result of this, is that when using untyped arguments, things could go wrong. An example of this is when using an integer.
This integer is interpreted as being a String, and hence it's converted to it's value, so int 1 becomes int 49. So, if you're unsure, use types in your fixtures.
</blockquote><p class="paragraph"/><h3>Automatic reloading of Fixtures</h3>
The Fixtures in the <code>grails-app/fitnesse</code> directory are automatically reloaded and injected by Grails. This enables faster testing and faster development!<p class="paragraph"/><h3>Functions are getters</h3>
Fitnesse decision tables do <strong class="bold">not</strong> have getters and setters, but setters and functions. A function is the same as a getter, but without the 'get' part. (Still with me?). An example:<p class="paragraph"/><strong class="bold">Normal Fitnesse</strong>
<div class="code"><pre>|my decision fixture|
|digit | roman?|
|1     |      I|
|5     |      V|</pre></div><p class="paragraph"/>This would result in the following Fixture:
<div class="code"><pre>class MyDecisionFixture &#123;
    <span class="java&#45;object">int</span> digit
    <span class="java&#45;object">String</span> roman<p class="paragraph"/>    void execute() &#123;
       roman = RomanNumberConverter.convertDigit(digit)
    &#125;<p class="paragraph"/>    <span class="java&#45;object">String</span> roman() &#123;
       <span class="java&#45;keyword">return</span> roman
    &#125;
&#125;</pre></div><p class="paragraph"/>This has been improved, so that Fitnesse also looks at getters:<p class="paragraph"/><strong class="bold">Improved Fitnesse</strong><p class="paragraph"/>This would result in the following Fixture:
<div class="code"><pre>class MyDecisionFixture &#123;
    <span class="java&#45;object">int</span> digit
    <span class="java&#45;object">String</span> roman<p class="paragraph"/>    void execute() &#123;
       roman = RomanNumberConverter.convertDigit(digit)
    &#125;
&#125;</pre></div><p class="paragraph"/><h3>Improved Stop Test Exceptions</h3><p class="paragraph"/>You can now throw <a href="http://fitnesse.org/FitNesse.UserGuide.SliM.ExceptionHandling" target="blank">StopTest Exceptions</a> from Fixture constructors, to halt all further test execution.
This is currently not handled correctly in the Java version of Fitnesse.
    </body>
</html>
